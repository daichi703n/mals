//This JavaScript get MALS registered link, and Replace HTML View
function getLink(){
  //console.log("getLink")
  // Select item on Server Side
  const got_link = new Promise((resolve,reject) => {
    const request = new XMLHttpRequest()
    request.open("GET", link_api)
    request.timeout = 30000; // time in milliseconds
    //Success
    request.addEventListener("load", (event) => {resolve(event.target.responseText)})
    //Fail
    request.ontimeout = function(e) {
      console.error("Request timed out - Please contact MALS help")
    }
    request.addEventListener("load", (event) => {
      if(event.target.status != 200){
        reject(console.error("HTTP Status: "+event.target.status+" - Please contact MALS help"));
      }
    });
    request.addEventListener("error", () => {
        reject(console.error("Network Error - Please contact MALS help"));
    });
    request.send()
  })
  return got_link
}

async function setLink(){
  const selected_link = await getLink()
  console.log("MALS Link has got")
  //console.log(selected_link)
  const target=document.getElementById("mals_replace_target")
  target.innerHTML = selected_link+msg
}

//console.log('/public/mals.js')
//const link_api = "/links"
const link_api = "/api/selector/v1/links/random"
//ToDo: in Advanced edition, msg will be unvisible
const msg = '<font color="lightgray"><br>'+
'This Link is Generated by MALS<br>'+
'<a href="https://mals.herokuapp.com" target="_blank">https://mals.herokuapp.com</a><br>'+
'</font>'

setLink()
//console.log("Finish mals.js")
